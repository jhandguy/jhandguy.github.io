<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lightweight Design Patterns in iOS (Part 3) - Coordinator</title>
    <link rel="stylesheet" href="/css/bulma.min.css">
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/hugo.css">
</head>

<body>
<nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            Home
        </a>

        <div class="navbar-item">
            <a class="button is-link" href="/about">
                <strong>About me</strong>
            </a>
        </div>
    </div>
</nav>

<section class="section">
    <div class="container is-max-desktop">
        <div class="content">
            <p class="title is-spaced">Lightweight Design Patterns in iOS (Part 3) - Coordinator</p>
            
            
            <div class="box">
                <p class="subtitle">Table of Contents</p>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#coordinator-pattern">Coordinator Pattern</a></li>
    <li><a href="#the-coordinator-in-practice">The Coordinator in practice</a></li>
    <li><a href="#testing-the-navigation-logic">Testing the Navigation Logic</a></li>
  </ul>
</nav>
            </div>
            
            
        </div>
    </div>
    <div class="container is-max-desktop mt-6">
        <div class="content has-text-justified-tablet">
            <p><strong>Design Patterns</strong> are part of Mobile Development for a while now and a revolution towards <em>Quality Assurance</em> is on. Such patterns have become a standard among the community, yet implementing an <em>academic</em> one might come with a price — <em>complexity</em>.</p>
<p>Because some <strong>Design Patterns</strong> solve very complex problems, they often result in a complicated implementation as well. So complex sometimes, that we tend to use heavy <strong>Third Party Frameworks</strong>, even for simple use cases.</p>
<blockquote>
<p>The time has come to combine quality and simplicity.</p>
</blockquote>
<p>🎬 Hi there, I’m Jean!</p>
<p>Previously on the series <strong>Lightweight Design Patterns in iOS</strong>, we have covered the case of the <a href="/posts/presenter-design-pattern-ios/">Presenter Pattern</a> or how to implement a lightweight presentation layer! 📺<br>
In this episode, we will take a quick look at the <strong>Coordinator Pattern</strong>, the problem it solves as well as how to implement it in a simple and yet powerful manner! 🚦</p>
<h2 id="coordinator-pattern">Coordinator Pattern</h2>
<hr>
<p>The role of the <strong>Coordinator</strong> is to coordinate the navigation between screens of the same flow. 🗺<br>
This means in Mobile Development: defining a <strong>user flow</strong>! 📲<br>
In iOS, the <strong>Storyboard</strong> is already providing this feature but it also comes with considerable drawbacks, such as loading time and testability. 😕<br>
The <strong>Coordinator</strong> allows you to separate the <strong>Navigation logic</strong> from the <strong>ViewController</strong> and define your screen flow directly in code! 💯</p>
<p>Let’s now look at an example! 👀</p>
<h2 id="the-coordinator-in-practice">The Coordinator in practice</h2>
<hr>
<p>We have an app, that displays a list of “things” and tapping on one of them opens a detail screen with more information concerning that item. Easy. 👍</p>
<p>Our navigation is going to look very concise: we will first <strong>start</strong> with a list of things and later on eventually <strong>open something</strong>. This flow definition is nothing else than our <strong>CoordinatorProtocol</strong>! 👌</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">protocol</span> <span class="nc">CoordinatorProtocol</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">open</span><span class="p">(</span><span class="kc">_</span> <span class="n">something</span><span class="p">:</span> <span class="n">Something</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Looking good! 😎<br>
Let’s now implement the actual <strong>Coordinator</strong>!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">Coordinator</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">window</span><span class="p">:</span> <span class="n">UIWindow</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">navigationController</span> <span class="p">=</span> <span class="n">UINavigationController</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">window</span><span class="p">:</span> <span class="n">UIWindow</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">window</span> <span class="p">=</span> <span class="n">window</span>
</span></span><span class="line"><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span> <span class="p">=</span> <span class="n">navigationController</span>
</span></span><span class="line"><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">makeKeyAndVisible</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As you can see, we need to inject a <em>UIWindow</em> in the <strong>init</strong> method, in order to make the <strong>navigationController</strong> the <em>rootViewController</em> of this window. 📱</p>
<p>Now, implementing the <em>CoordinatorProtocol</em> will only consist of instantiating the <em>ViewControllers</em> with their dependencies injected and push them to the <em>NavigationController</em>! 💯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Coordinator</span><span class="p">:</span> <span class="n">CoordinatorProtocol</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">MainViewController</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewController</span><span class="p">.</span><span class="n">viewModel</span> <span class="p">=</span> <span class="n">MainViewModel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewController</span><span class="p">.</span><span class="n">coordinator</span> <span class="p">=</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">        <span class="n">navigationController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">open</span><span class="p">(</span><span class="kc">_</span> <span class="n">something</span><span class="p">:</span> <span class="n">Something</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">SomethingViewController</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewController</span><span class="p">.</span><span class="n">viewModel</span> <span class="p">=</span> <span class="n">SomethingViewModel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewController</span><span class="p">.</span><span class="n">coordinator</span> <span class="p">=</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">        <span class="n">navigationController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>And that’s it! Our flow is now implemented, and can be <strong>started/continued</strong> from anywhere in the App! 🎉</p>
<p>Let’s start with the <em>AppDelegate</em>!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">@UIApplicationMain</span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">AppDelegate</span><span class="p">:</span> <span class="n">UIResponder</span><span class="p">,</span> <span class="n">UIApplicationDelegate</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">coordinator</span><span class="p">:</span> <span class="n">CoordinatorProtocol</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="kc">_</span> <span class="n">application</span><span class="p">:</span> <span class="n">UIApplication</span><span class="p">,</span> <span class="n">willFinishLaunchingWithOptions</span> <span class="n">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="n">UIApplication</span><span class="p">.</span><span class="n">LaunchOptionsKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]?</span> <span class="p">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">coordinator</span> <span class="p">=</span> <span class="n">Coordinator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="kc">_</span> <span class="n">application</span><span class="p">:</span> <span class="n">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="n">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="n">UIApplication</span><span class="p">.</span><span class="n">LaunchOptionsKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]?)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">coordinator</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Nice and simple! Now let’s look at the <em>MainViewController</em>!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">MainViewController</span><span class="p">:</span> <span class="n">UITableViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">weak</span> <span class="kd">var</span> <span class="nv">coordinator</span><span class="p">:</span> <span class="n">CoordinatorProtocol</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="n">SomethingViewModel</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kr">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="kc">_</span> <span class="n">tableView</span><span class="p">:</span> <span class="n">UITableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span> <span class="n">indexPath</span><span class="p">:</span> <span class="n">IndexPath</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">something</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">somethings</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">coordinator</span><span class="p">?.</span><span class="n">open</span><span class="p">(</span><span class="n">something</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>That’s it! The entire <strong>Navigation Logic</strong> has just been delegated to an independent layer! 🎊</p>
<h2 id="testing-the-navigation-logic">Testing the Navigation Logic</h2>
<hr>
<p>Unit testing the navigation has never been easier!<br>
Before writing any test, let’s implement a <em>CoordinatorMock</em> first! 🐚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">CoordinatorMock</span><span class="p">:</span> <span class="n">CoordinatorProtocol</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span><span class="p">(</span><span class="kr">set</span><span class="p">)</span> <span class="kd">var</span> <span class="nv">isStarted</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span><span class="p">(</span><span class="kr">set</span><span class="p">)</span> <span class="kd">var</span> <span class="nv">isSomethingOpened</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isStarted</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">open</span><span class="p">(</span><span class="kc">_</span> <span class="n">something</span><span class="p">:</span> <span class="n">Something</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isSomethingOpened</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As you can see, we are just implementing the <em>CoordinatorProtocol</em> and toggle the respective boolean properties whenever a method is called. 🚀<br>
Simple right?! Well, look at how easy testing now is! 💪</p>
<p>Let’s start with the <em>AppDelegate</em> and verify the <strong>start</strong> method is called!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">AppDelegateTest</span><span class="p">:</span> <span class="n">XCTestCase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">sut</span><span class="p">:</span> <span class="n">AppDelegate</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kc">super</span><span class="p">.</span><span class="n">setUp</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">sut</span> <span class="p">=</span> <span class="n">AppDelegate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">testAppDelegateStartsCoordinatorSuccessfully</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">coordinator</span> <span class="p">=</span> <span class="n">CoordinatorMock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">sut</span><span class="p">.</span><span class="n">coordinator</span> <span class="p">=</span> <span class="n">coordinator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kc">_</span> <span class="p">=</span> <span class="n">sut</span><span class="p">.</span><span class="n">application</span><span class="p">(</span><span class="n">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="p">:</span> <span class="p">[:])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">XCTAssertTrue</span><span class="p">(</span><span class="n">coordinator</span><span class="p">.</span><span class="n">isStarted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Marvellous! 💄</p>
<p>And now with the <em>MainViewController</em>, let’s make sure the <strong>open</strong> function is called!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">MainViewControllerTest</span><span class="p">:</span> <span class="n">XCTestCase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">sut</span><span class="p">:</span> <span class="n">MainViewController</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="kr">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kc">super</span><span class="p">.</span><span class="n">setUp</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sut</span> <span class="p">=</span> <span class="n">MainViewController</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sut</span><span class="p">.</span><span class="n">viewModel</span> <span class="p">=</span> <span class="n">SomethingViewModel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kc">_</span> <span class="p">=</span> <span class="n">sut</span><span class="p">.</span><span class="n">view</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">func</span> <span class="nf">testMainViewControllerOpensSomethingSuccessfully</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">coordinator</span> <span class="p">=</span> <span class="n">CoordinatorMock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sut</span><span class="p">.</span><span class="n">coordinator</span> <span class="p">=</span> <span class="n">coordinator</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">sut</span><span class="p">.</span><span class="n">tableView</span><span class="p">(</span><span class="n">sut</span><span class="p">.</span><span class="n">tableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span><span class="p">:</span> <span class="n">IndexPath</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssertTrue</span><span class="p">(</span><span class="n">coordinator</span><span class="p">.</span><span class="n">isSomethingOpened</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>And boom! 💥<br>
We just made a lightweight <strong>Coordinator</strong> which is even testable! 🎉</p>
<p>Worth it? Did that help you see what problems the <strong>Coordinator Pattern</strong> is trying to solve? How to make such a pattern lightweight?</p>
<p>If so, follow me on <a href="https://twitter.com/jhandguy">Twitter</a>, I’ll be happy to answer any of your questions and you’ll be the first one to know when a new article comes out! 👌</p>
<p>See you next week, for the Part 4 of my series <strong>Lightweight Design Patterns in iOS</strong>!</p>
<p>Bye bye! 👋</p>

        </div>
    </div>
</section>

</body>
<footer>
    <div class="footer pt-3 has-background-black-bis">
        <div class="container pb-6 has-text-centered is-mobile columns">
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/presenter-design-pattern-ios/"><strong>👈</strong></a>
                
                
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                <a class="button is-large" href="#"><strong>👆</strong></a>
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/factory-design-pattern-ios/"><strong>👉</strong></a>
                
                
            </div>
        </div>
        <div class="content has-text-centered">
            <p class="subtitle is-6">Powered by <a href="https://gohugo.io/">Hugo</a></p>
            <a href="https://bulma.io">
                <img src="/images/footer/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
        </div>
    </div>
</footer>

</html>
