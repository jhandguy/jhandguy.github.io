<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UI Testing in iOS - Robot Pattern</title>
    <link rel="stylesheet" href="/css/bulma.min.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>

<body>
<nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            Home
        </a>

        <div class="navbar-item">
            <a class="button is-link" href="/about">
                <strong>About me</strong>
            </a>
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
        <div class="content">
            <p class="title is-spaced">UI Testing in iOS - Robot Pattern</p>
            
            
            <div class="box">
                <p class="subtitle">Table of Contents</p>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#the-usual-way">The usual way</a></li>
    <li><a href="#beep-beep-boop-">Beep‚Ä¶ Beep‚Ä¶ Boop‚Ä¶ ü§ñ</a></li>
    <li><a href="#the-robot-in-action">The Robot in action!</a></li>
  </ul>
</nav>
            </div>
            
            
        </div>
    </div>
    <div class="container mt-6">
        <div class="content has-text-justified">
            <p>Most of the time, UI Testing gets abandoned because it becomes harder to maintain over time and one reason for that is: <strong>readability</strong>. We also tend to forget that UI tests should not only serve the purpose of verification but provide meaningful documentation that everybody (including non-developers) can understand. Alright, let‚Äôs get right into it, fellas!</p>
<blockquote>
<p>What if we could write UI Tests in a human-readable language, that even a Product Owner could understand?</p>
</blockquote>
<p>üé¨ Hi there, I‚Äôm Jean!</p>
<p>In this article, I am going to introduce a better way to write UI Tests using XCTest! üòÉ<br>
<em>Note: third-party libraries such as Appium or Calabash won‚Äôt be part of this post.</em></p>
<h2 id="the-usual-way">The usual way</h2>
<hr>
<p>Usually, all UI Testing logic is bundled in one test function. Which inevitably leads to this‚Ä¶</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">uglyUITest</span>() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    app.launch()
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">title</span> = app.navigationBars.firstMatch.otherElements.firstMatch
</span></span><span style="display:flex;"><span>    XCTAssert(title.isHittable)
</span></span><span style="display:flex;"><span>    XCTAssertEqual(title.label, <span style="color:#fc6a5d">&#34;U.S. - Politics&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">stackView</span> = app.otherElements[<span style="color:#fc6a5d">&#34;StoryView.stackView&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">multimediaImage</span> = stackView.images[<span style="color:#fc6a5d">&#34;StoryView.multimediaImageView&#34;</span>]
</span></span><span style="display:flex;"><span>    XCTAssert(multimediaImage.isHittable)
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">titleLabel</span> = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.titleLabel&#34;</span>]
</span></span><span style="display:flex;"><span>    XCTAssertEqual(titleLabel.label, <span style="color:#fc6a5d">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">abstractLabel</span> = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.abstractLabel&#34;</span>]
</span></span><span style="display:flex;"><span>    XCTAssertEqual(abstractLabel.label, <span style="color:#fc6a5d">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">bylineLabel</span> = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.bylineLabel&#34;</span>]
</span></span><span style="display:flex;"><span>    XCTAssertEqual(bylineLabel.label, <span style="color:#fc6a5d">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span>)
</span></span><span style="display:flex;"><span>    snapshot(<span style="color:#fc6a5d">&#34;Story&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I am sure you didn‚Äôt even finish reading that you already jumped to this line.<br>
And to be fair, I‚Äôm not angry at you; this UI Test was fairly <strong>unreadable</strong>! üòµ</p>
<p>And the main reason for that is:</p>
<blockquote>
<p>Common UI Tests are mixing the What and the How altogether, in one place.</p>
</blockquote>
<p>Well, that‚Äôs obviously a problem, as this isn‚Äôt following the <a href="https://clean-code-developer.de/die-grade/orangener-grad/#Separation_of_Concerns_SoC">Separation of Concern</a> <strong>Clean Code</strong> teaches us‚Ä¶ ü§î</p>
<h2 id="beep-beep-boop-">Beep‚Ä¶ Beep‚Ä¶ Boop‚Ä¶ ü§ñ</h2>
<hr>
<p>That‚Äôs right! Introducing, the <strong>Robot Pattern</strong> by <a href="https://jakewharton.com/testing-robots/">Jake Wharton</a>! üëè<br>
The idea Jake had for the Android community is to separate in a UI Test the <em>What</em> from the <em>How</em>.<br>
And to achieve this, he introduced a new layer called: <strong>Robot</strong>.</p>
<p>Transcribed to iOS (Swift), our UI Test now looks like this‚Ä¶</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">prettyUITest</span>() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    StoryRobot(app)
</span></span><span style="display:flex;"><span>        .start()
</span></span><span style="display:flex;"><span>        .checkTitle(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;U.S. - Politics&#34;</span>)
</span></span><span style="display:flex;"><span>        .checkStoryImage()
</span></span><span style="display:flex;"><span>        .checkStoryTitle(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span>)
</span></span><span style="display:flex;"><span>        .checkStoryAbstract(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span>)
</span></span><span style="display:flex;"><span>        .checkStoryByline(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span>)
</span></span><span style="display:flex;"><span>        .takeScreenshot(named: <span style="color:#fc6a5d">&#34;Story&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>How about that, didn‚Äôt it feel right to read the whole function this time? üòç<br>
Exactly, in the UI Test itself, we are now left only with the <em>What</em> and the <em>How</em> is delegated to the <strong>Robot</strong>. Meaning: anybody can read and understand it! üëç</p>
<h2 id="the-robot-in-action">The Robot in action!</h2>
<hr>
<p>First and foremost, we are going to implement a base <em>Robot</em>.<br>
This class will take care of setting up Fastlane‚Äôs Snapshot, launching the app and providing a nice panel of util functions, such as tapping on elements, making assertions and taking screenshots‚Ä¶ üëå</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">class</span> <span style="color:#5dd8ff">Robot</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">static</span> <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">defaultTimeout</span>: <span style="color:#d0a8ff">Double</span> = <span style="color:#d0bf69">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">app</span>: XCUIApplication
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">navigationBar</span>       = app.navigationBars.firstMatch
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">navigationBarButton</span> = navigationBar.buttons.firstMatch
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">navigationBarTitle</span>  = navigationBar.otherElements.firstMatch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">init</span>(<span style="color:#fc5fa3">_</span> app: XCUIApplication) {
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">self</span>.app = app
</span></span><span style="display:flex;"><span>        setupSnapshot(app)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">start</span>(timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        app.launch()
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(app, [.exists], timeout: timeout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">tap</span>(<span style="color:#fc5fa3">_</span> element: XCUIElement, timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(element, [.isHittable], timeout: timeout)
</span></span><span style="display:flex;"><span>        element.tap()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">assert</span>(<span style="color:#fc5fa3">_</span> element: XCUIElement, <span style="color:#fc5fa3">_</span> predicates: [Predicate], timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">expectation</span> = XCTNSPredicateExpectation(predicate: NSPredicate(format: predicates.<span style="color:#a167e6">map</span> { <span style="color:#41a1c0">$0</span>.format }.joined(separator: <span style="color:#fc6a5d">&#34; AND &#34;</span>)), object: element)
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">guard</span> XCTWaiter.wait(<span style="color:#fc5fa3">for</span>: [expectation], timeout: timeout) == .completed <span style="color:#fc5fa3">else</span> {
</span></span><span style="display:flex;"><span>            XCTFail(<span style="color:#fc6a5d">&#34;[</span><span style="color:#fc6a5d">\(</span><span style="color:#fc5fa3">self</span><span style="color:#fc6a5d">)</span><span style="color:#fc6a5d">] Element </span><span style="color:#fc6a5d">\(</span>element.description<span style="color:#fc6a5d">)</span><span style="color:#fc6a5d"> did not fulfill expectation: </span><span style="color:#fc6a5d">\(</span>predicates.<span style="color:#a167e6">map</span> { <span style="color:#41a1c0">$0</span>.format }<span style="color:#fc6a5d">)</span><span style="color:#fc6a5d">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">checkTitle</span>(<span style="color:#a167e6">contains</span> title: <span style="color:#d0a8ff">String</span>, timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(navigationBar, [.isHittable], timeout: timeout)
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(navigationBarTitle, [.<span style="color:#a167e6">contains</span>(title)], timeout: timeout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">takeScreenshot</span>(named name: <span style="color:#d0a8ff">String</span>, timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        snapshot(name, timeWaitingForIdle: timeout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">back</span>(timeout: TimeInterval = Robot.defaultTimeout) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        tap(navigationBarButton, timeout: timeout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Simple, right?<br>
Oh, by the way, here is the Predicate enum I am using for making assertions, you‚Äôll find it quite handy! üòé</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">enum</span> <span style="color:#5dd8ff">Predicate</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">case</span> <span style="color:#a167e6">contains</span>(<span style="color:#d0a8ff">String</span>), doesNotContain(<span style="color:#d0a8ff">String</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">case</span> exists, doesNotExist
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">case</span> isHittable, isNotHittable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">format</span>: <span style="color:#d0a8ff">String</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">switch</span> <span style="color:#fc5fa3">self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .<span style="color:#a167e6">contains</span>(<span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">label</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;label == &#39;</span><span style="color:#fc6a5d">\(</span>label<span style="color:#fc6a5d">)</span><span style="color:#fc6a5d">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .doesNotContain(<span style="color:#fc5fa3">let</span> <span style="color:#41a1c0">label</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;label != &#39;</span><span style="color:#fc6a5d">\(</span>label<span style="color:#fc6a5d">)</span><span style="color:#fc6a5d">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .exists:
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;exists == true&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .doesNotExist:
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;exists == false&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .isHittable:
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;isHittable == true&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">case</span> .isNotHittable:
</span></span><span style="display:flex;"><span>            <span style="color:#fc5fa3">return</span> <span style="color:#fc6a5d">&#34;isHittable == false&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Alright! Now our Base <strong>Robot</strong> class is ready, let‚Äôs inherit from it in the <em>StoryRobot</em> and see how it plays out! ü§ñ</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">final</span> <span style="color:#fc5fa3">class</span> <span style="color:#5dd8ff">StoryRobot</span>: Robot {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">stackView</span>       = app.otherElements[<span style="color:#fc6a5d">&#34;StoryView.stackView&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">multimediaImage</span> = stackView.images[<span style="color:#fc6a5d">&#34;StoryView.multimediaImageView&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">titleLabel</span>      = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.titleLabel&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">abstractLabel</span>   = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.abstractLabel&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">bylineLabel</span>     = stackView.staticTexts[<span style="color:#fc6a5d">&#34;StoryView.bylineLabel&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">checkStoryImage</span>() -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(multimediaImage, [.exists])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">checkStoryTitle</span>(<span style="color:#a167e6">contains</span> storyTitle: <span style="color:#d0a8ff">String</span>) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(titleLabel, [.isHittable, .<span style="color:#a167e6">contains</span>(storyTitle)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">checkStoryAbstract</span>(<span style="color:#a167e6">contains</span> storyAbstract: <span style="color:#d0a8ff">String</span>) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(abstractLabel, [.isHittable, .<span style="color:#a167e6">contains</span>(storyAbstract)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @discardableResult
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">checkStoryByline</span>(<span style="color:#a167e6">contains</span> storyByline: <span style="color:#d0a8ff">String</span>) -&gt; <span style="color:#fc5fa3">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a167e6">assert</span>(bylineLabel, [.isHittable, .<span style="color:#a167e6">contains</span>(storyByline)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fc5fa3">return</span> <span style="color:#fc5fa3">self</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That‚Äôs it! We‚Äôve just implemented the <em>How</em> of our UI Test! üéä<br>
What‚Äôs also really nice about <strong>Robots</strong>, is that they can cross call themselves without breaking the continuity of our UI Tests! ü§Ø</p>
<p>For instance, let‚Äôs say we want to open Safari in the <em>StoryUITest</em>.<br>
All we need to do is create a <em>SafariRobot</em> which will take care of UI Testing the browser and create a function inside the <em>StoryRobot</em> that will open Safari as well as return the <em>SafariRobot</em>! üòÆ</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">urlButton</span> = stackView.buttons[<span style="color:#fc6a5d">&#34;StoryView.urlButton&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@discardableResult
</span></span><span style="display:flex;"><span><span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">openSafari</span>() -&gt; SafariRobot {
</span></span><span style="display:flex;"><span>    tap(urlButton)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">return</span> SafariRobot(app)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And as you can see now, the continuity of our UI Test isn‚Äôt disturbed‚Ä¶</p>
<div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#fc5fa3">final</span> <span style="color:#fc5fa3">class</span> <span style="color:#5dd8ff">StoryUITest</span>: XCTestCase {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">private</span> <span style="color:#fc5fa3">lazy</span> <span style="color:#fc5fa3">var</span> <span style="color:#41a1c0">app</span> = XCUIApplication()
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fc5fa3">func</span> <span style="color:#41a1c0">testStory</span>() {
</span></span><span style="display:flex;"><span>        StoryRobot(app)
</span></span><span style="display:flex;"><span>            .start()
</span></span><span style="display:flex;"><span>            .checkTitle(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;U.S. - Politics&#34;</span>)
</span></span><span style="display:flex;"><span>            .checkStoryImage()
</span></span><span style="display:flex;"><span>            .checkStoryTitle(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span>)
</span></span><span style="display:flex;"><span>            .checkStoryAbstract(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span>)
</span></span><span style="display:flex;"><span>            .checkStoryByline(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span>)
</span></span><span style="display:flex;"><span>            .takeScreenshot(named: <span style="color:#fc6a5d">&#34;Story&#34;</span>)
</span></span><span style="display:flex;"><span>            .openSafari()
</span></span><span style="display:flex;"><span>            .checkURL(<span style="color:#a167e6">contains</span>: <span style="color:#fc6a5d">&#34;https://www.nytimes.com/2018/08/27/us/politics/trump-endorsements.html&#34;</span>)
</span></span><span style="display:flex;"><span>            .closeSafari()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Boom! üí•<br>
We just implemented the Robot Pattern! üéâ<br>
UI Testing is now easy, elegant and readable! üí™</p>
<p>Worth a try? Did you regain faith in UI Testing? If so, follow me on <a href="https://twitter.com/jhandguy">Twitter</a>, I‚Äôll be happy to answer any of your questions and you‚Äôll be the first one to know when a new article comes out! üëå</p>
<p>Want to read more about UI Testing?<br>
Check out <a href="/posts/generating-accessibility-identifiers-ios/">UI Testing in iOS - Generating Accessibility Identifiers using Reflection</a>, as well as my 3 parts series:</p>
<ol>
<li><a href="/posts/mocking-the-network-ios/">Painless UI Testing in iOS (Part 1) - Mocking the Network</a></li>
<li><a href="/posts/stubbing-the-navigation-ios/">Painless UI Testing in iOS (Part 2) - Stubbing the Navigation</a></li>
<li><a href="/posts/disabling-animations-ios/">Painless UI Testing in iOS (Part 3) - Disabling Animations</a></li>
</ol>
<p>If you‚Äôd like to see a <strong>real-life example of an app doing extensive UI Testing</strong>, don‚Äôt hesitate to check out my <a href="https://github.com/jhandguy/SwiftKotlination">Github</a> repo! üì¶</p>
<p>Until next time, happy testing! ü§ñ</p>
<p>Bye Bye! üëã</p>

        </div>
    </div>
</section>

</body>
<footer>
    <div class="footer pt-3 has-background-black-bis">
        <div class="container pb-6 has-text-centered is-mobile columns">
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/generating-accessibility-identifiers-ios/"><strong>üëà</strong></a>
                
                
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                <a class="button is-large" href="#"><strong>üëÜ</strong></a>
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/path-to-cicd-nirvana-ios/"><strong>üëâ</strong></a>
                
                
            </div>
        </div>
        <div class="content has-text-centered">
            <p class="subtitle is-6">Powered by <a href="https://gohugo.io/">Hugo</a></p>
            <a href="https://bulma.io">
                <img src="/images/footer/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
        </div>
    </div>
</footer>

</html>
