<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UI Testing in iOS - Robot Pattern</title>
    <link rel="stylesheet" href="/css/bulma.min.css">
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/hugo.css">
</head>

<body>
<nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            Home
        </a>

        <div class="navbar-item">
            <a class="button is-link" href="/about">
                <strong>About me</strong>
            </a>
        </div>
    </div>
</nav>

<section class="section">
    <div class="container is-max-desktop">
        <div class="content">
            <p class="title is-spaced">UI Testing in iOS - Robot Pattern</p>
            
            
            <div class="box">
                <p class="subtitle">Table of Contents</p>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#the-usual-way">The usual way</a></li>
    <li><a href="#beep-beep-boop-">Beep‚Ä¶ Beep‚Ä¶ Boop‚Ä¶ ü§ñ</a></li>
    <li><a href="#the-robot-in-action">The Robot in action!</a></li>
  </ul>
</nav>
            </div>
            
            
        </div>
    </div>
    <div class="container is-max-desktop mt-6">
        <div class="content has-text-justified-tablet">
            <p>Most of the time, UI Testing gets abandoned because it becomes harder to maintain over time and one reason for that is: <strong>readability</strong>. We also tend to forget that UI tests should not only serve the purpose of verification but provide meaningful documentation that everybody (including non-developers) can understand. Alright, let‚Äôs get right into it, fellas!</p>
<blockquote>
<p>What if we could write UI Tests in a human-readable language, that even a Product Owner could understand?</p>
</blockquote>
<p>üé¨ Hi there, I‚Äôm Jean!</p>
<p>In this article, I am going to introduce a better way to write UI Tests using XCTest! üòÉ<br>
<em>Note: third-party libraries such as Appium or Calabash won‚Äôt be part of this post.</em></p>
<h2 id="the-usual-way">The usual way</h2>
<hr>
<p>Usually, all UI Testing logic is bundled in one test function. Which inevitably leads to this‚Ä¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">uglyUITest</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">title</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">navigationBars</span><span class="p">.</span><span class="n">firstMatch</span><span class="p">.</span><span class="n">otherElements</span><span class="p">.</span><span class="n">firstMatch</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssert</span><span class="p">(</span><span class="n">title</span><span class="p">.</span><span class="n">isHittable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">title</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="s">&#34;U.S. - Politics&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">stackView</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">otherElements</span><span class="p">[</span><span class="s">&#34;StoryView.stackView&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">multimediaImage</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">images</span><span class="p">[</span><span class="s">&#34;StoryView.multimediaImageView&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssert</span><span class="p">(</span><span class="n">multimediaImage</span><span class="p">.</span><span class="n">isHittable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">titleLabel</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.titleLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">titleLabel</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="s">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">abstractLabel</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.abstractLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">abstractLabel</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="s">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">bylineLabel</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.bylineLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">bylineLabel</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="s">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">snapshot</span><span class="p">(</span><span class="s">&#34;Story&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>I am sure you didn‚Äôt even finish reading that you already jumped to this line.<br>
And to be fair, I‚Äôm not angry at you; this UI Test was fairly <strong>unreadable</strong>! üòµ</p>
<p>And the main reason for that is:</p>
<blockquote>
<p>Common UI Tests are mixing the What and the How altogether, in one place.</p>
</blockquote>
<p>Well, that‚Äôs obviously a problem, as this isn‚Äôt following the <a href="https://clean-code-developer.de/die-grade/orangener-grad/#Separation_of_Concerns_SoC">Separation of Concern</a> <strong>Clean Code</strong> teaches us‚Ä¶ ü§î</p>
<h2 id="beep-beep-boop-">Beep‚Ä¶ Beep‚Ä¶ Boop‚Ä¶ ü§ñ</h2>
<hr>
<p>That‚Äôs right! Introducing, the <strong>Robot Pattern</strong> by <a href="https://jakewharton.com/testing-robots/">Jake Wharton</a>! üëè<br>
The idea Jake had for the Android community is to separate in a UI Test the <em>What</em> from the <em>How</em>.<br>
And to achieve this, he introduced a new layer called: <strong>Robot</strong>.</p>
<p>Transcribed to iOS (Swift), our UI Test now looks like this‚Ä¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">prettyUITest</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">StoryRobot</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">checkTitle</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;U.S. - Politics&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">checkStoryImage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">checkStoryTitle</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">checkStoryAbstract</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">checkStoryByline</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">takeScreenshot</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&#34;Story&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>How about that, didn‚Äôt it feel right to read the whole function this time? üòç<br>
Exactly, in the UI Test itself, we are now left only with the <em>What</em> and the <em>How</em> is delegated to the <strong>Robot</strong>. Meaning: anybody can read and understand it! üëç</p>
<h2 id="the-robot-in-action">The Robot in action!</h2>
<hr>
<p>First and foremost, we are going to implement a base <em>Robot</em>.<br>
This class will take care of setting up Fastlane‚Äôs Snapshot, launching the app and providing a nice panel of util functions, such as tapping on elements, making assertions and taking screenshots‚Ä¶ üëå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Robot</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">let</span> <span class="nv">defaultTimeout</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">app</span><span class="p">:</span> <span class="n">XCUIApplication</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">navigationBar</span>       <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">navigationBars</span><span class="p">.</span><span class="n">firstMatch</span>
</span></span><span class="line"><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">navigationBarButton</span> <span class="p">=</span> <span class="n">navigationBar</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">firstMatch</span>
</span></span><span class="line"><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">navigationBarTitle</span>  <span class="p">=</span> <span class="n">navigationBar</span><span class="p">.</span><span class="n">otherElements</span><span class="p">.</span><span class="n">firstMatch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">app</span><span class="p">:</span> <span class="n">XCUIApplication</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">app</span> <span class="p">=</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">        <span class="n">setupSnapshot</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">start</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[.</span><span class="n">exists</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">tap</span><span class="p">(</span><span class="kc">_</span> <span class="n">element</span><span class="p">:</span> <span class="n">XCUIElement</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">[.</span><span class="n">isHittable</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">element</span><span class="p">.</span><span class="n">tap</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">assert</span><span class="p">(</span><span class="kc">_</span> <span class="n">element</span><span class="p">:</span> <span class="n">XCUIElement</span><span class="p">,</span> <span class="kc">_</span> <span class="n">predicates</span><span class="p">:</span> <span class="p">[</span><span class="n">Predicate</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">expectation</span> <span class="p">=</span> <span class="n">XCTNSPredicateExpectation</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">NSPredicate</span><span class="p">(</span><span class="n">format</span><span class="p">:</span> <span class="n">predicates</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">format</span> <span class="p">}.</span><span class="n">joined</span><span class="p">(</span><span class="n">separator</span><span class="p">:</span> <span class="s">&#34; AND &#34;</span><span class="p">)),</span> <span class="n">object</span><span class="p">:</span> <span class="n">element</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">guard</span> <span class="n">XCTWaiter</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">[</span><span class="n">expectation</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span> <span class="p">==</span> <span class="p">.</span><span class="n">completed</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">XCTFail</span><span class="p">(</span><span class="s">&#34;[</span><span class="si">\(</span><span class="kc">self</span><span class="si">)</span><span class="s">] Element </span><span class="si">\(</span><span class="n">element</span><span class="p">.</span><span class="n">description</span><span class="si">)</span><span class="s"> did not fulfill expectation: </span><span class="si">\(</span><span class="n">predicates</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">format</span> <span class="p">}</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">checkTitle</span><span class="p">(</span><span class="bp">contains</span> <span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">navigationBar</span><span class="p">,</span> <span class="p">[.</span><span class="n">isHittable</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">navigationBarTitle</span><span class="p">,</span> <span class="p">[.</span><span class="bp">contains</span><span class="p">(</span><span class="n">title</span><span class="p">)],</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">takeScreenshot</span><span class="p">(</span><span class="n">named</span> <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">snapshot</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timeWaitingForIdle</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">back</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="n">Robot</span><span class="p">.</span><span class="n">defaultTimeout</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">tap</span><span class="p">(</span><span class="n">navigationBarButton</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Simple, right?<br>
Oh, by the way, here is the Predicate enum I am using for making assertions, you‚Äôll find it quite handy! üòé</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">enum</span> <span class="nc">Predicate</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="bp">contains</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span> <span class="n">doesNotContain</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">exists</span><span class="p">,</span> <span class="n">doesNotExist</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">isHittable</span><span class="p">,</span> <span class="n">isNotHittable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">format</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="kc">self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="kd">let</span> <span class="nv">label</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;label == &#39;</span><span class="si">\(</span><span class="n">label</span><span class="si">)</span><span class="s">&#39;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">doesNotContain</span><span class="p">(</span><span class="kd">let</span> <span class="nv">label</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;label != &#39;</span><span class="si">\(</span><span class="n">label</span><span class="si">)</span><span class="s">&#39;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">exists</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;exists == true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">doesNotExist</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;exists == false&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">isHittable</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;isHittable == true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">isNotHittable</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;isHittable == false&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Alright! Now our Base <strong>Robot</strong> class is ready, let‚Äôs inherit from it in the <em>StoryRobot</em> and see how it plays out! ü§ñ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">StoryRobot</span><span class="p">:</span> <span class="n">Robot</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">stackView</span>       <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">otherElements</span><span class="p">[</span><span class="s">&#34;StoryView.stackView&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">multimediaImage</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">images</span><span class="p">[</span><span class="s">&#34;StoryView.multimediaImageView&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">titleLabel</span>      <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.titleLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">abstractLabel</span>   <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.abstractLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">bylineLabel</span>     <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">staticTexts</span><span class="p">[</span><span class="s">&#34;StoryView.bylineLabel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">checkStoryImage</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">multimediaImage</span><span class="p">,</span> <span class="p">[.</span><span class="n">exists</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">checkStoryTitle</span><span class="p">(</span><span class="bp">contains</span> <span class="n">storyTitle</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">titleLabel</span><span class="p">,</span> <span class="p">[.</span><span class="n">isHittable</span><span class="p">,</span> <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="n">storyTitle</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">checkStoryAbstract</span><span class="p">(</span><span class="bp">contains</span> <span class="n">storyAbstract</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">abstractLabel</span><span class="p">,</span> <span class="p">[.</span><span class="n">isHittable</span><span class="p">,</span> <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="n">storyAbstract</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">checkStoryByline</span><span class="p">(</span><span class="bp">contains</span> <span class="n">storyByline</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">assert</span><span class="p">(</span><span class="n">bylineLabel</span><span class="p">,</span> <span class="p">[.</span><span class="n">isHittable</span><span class="p">,</span> <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="n">storyByline</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>That‚Äôs it! We‚Äôve just implemented the <em>How</em> of our UI Test! üéä<br>
What‚Äôs also really nice about <strong>Robots</strong>, is that they can cross call themselves without breaking the continuity of our UI Tests! ü§Ø</p>
<p>For instance, let‚Äôs say we want to open Safari in the <em>StoryUITest</em>.<br>
All we need to do is create a <em>SafariRobot</em> which will take care of UI Testing the browser and create a function inside the <em>StoryRobot</em> that will open Safari as well as return the <em>SafariRobot</em>! üòÆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">urlButton</span> <span class="p">=</span> <span class="n">stackView</span><span class="p">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&#34;StoryView.urlButton&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">discardableResult</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">openSafari</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SafariRobot</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">tap</span><span class="p">(</span><span class="n">urlButton</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">SafariRobot</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>And as you can see now, the continuity of our UI Test isn‚Äôt disturbed‚Ä¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kr">final</span> <span class="kd">class</span> <span class="nc">StoryUITest</span><span class="p">:</span> <span class="n">XCTestCase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">app</span> <span class="p">=</span> <span class="n">XCUIApplication</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">testStory</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">StoryRobot</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkTitle</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;U.S. - Politics&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkStoryImage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkStoryTitle</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;A Trump Endorsement Can Decide a Race. Here‚Äôs How to Get One.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkStoryAbstract</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;The president‚Äôs grip on G.O.P. primary voters is as strong as it has been since he seized the party‚Äôs nomination.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkStoryByline</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;By JONATHAN MARTIN and MAGGIE HABERMAN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">takeScreenshot</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&#34;Story&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">openSafari</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">checkURL</span><span class="p">(</span><span class="bp">contains</span><span class="p">:</span> <span class="s">&#34;https://www.nytimes.com/2018/08/27/us/politics/trump-endorsements.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">closeSafari</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Boom! üí•<br>
We just implemented the Robot Pattern! üéâ<br>
UI Testing is now easy, elegant and readable! üí™</p>
<p>Worth a try? Did you regain faith in UI Testing? If so, follow me on <a href="https://twitter.com/jhandguy">Twitter</a>, I‚Äôll be happy to answer any of your questions and you‚Äôll be the first one to know when a new article comes out! üëå</p>
<p>Want to read more about UI Testing?<br>
Check out <a href="/posts/generating-accessibility-identifiers-ios/">UI Testing in iOS - Generating Accessibility Identifiers using Reflection</a>, as well as my 3 parts series:</p>
<ol>
<li><a href="/posts/mocking-the-network-ios/">Painless UI Testing in iOS (Part 1) - Mocking the Network</a></li>
<li><a href="/posts/stubbing-the-navigation-ios/">Painless UI Testing in iOS (Part 2) - Stubbing the Navigation</a></li>
<li><a href="/posts/disabling-animations-ios/">Painless UI Testing in iOS (Part 3) - Disabling Animations</a></li>
</ol>
<p>If you‚Äôd like to see a <strong>real-life example of an app doing extensive UI Testing</strong>, don‚Äôt hesitate to check out my <a href="https://github.com/jhandguy/SwiftKotlination">Github</a> repo! üì¶</p>
<p>Until next time, happy testing! ü§ñ</p>
<p>Bye Bye! üëã</p>

        </div>
    </div>
</section>

</body>
<footer>
    <div class="footer pt-3 has-background-black-bis">
        <div class="container pb-6 has-text-centered is-mobile columns">
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/generating-accessibility-identifiers-ios/"><strong>üëà</strong></a>
                
                
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                <a class="button is-large" href="#"><strong>üëÜ</strong></a>
            </div>
            <div class="column"></div>
            <div class="column is-narrow paddingless">
                
                
                <a class="button is-large" href="https://jhandguy.github.io/posts/path-to-cicd-nirvana-ios/"><strong>üëâ</strong></a>
                
                
            </div>
        </div>
        <div class="content has-text-centered">
            <p class="subtitle is-6">Powered by <a href="https://gohugo.io/">Hugo</a></p>
            <a href="https://bulma.io">
                <img src="/images/footer/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
        </div>
    </div>
</footer>

</html>
